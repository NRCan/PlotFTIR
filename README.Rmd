---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
library(magrittr)
```

# PlotFTIR

<!-- badges: start -->
[![R-CMD-check](https://github.com/pbulsink/PlotFTIR/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/pbulsink/PlotFTIR/actions/workflows/R-CMD-check.yaml)
[![codecov](https://codecov.io/gh/pbulsink/PlotFTIR/graph/badge.svg?token=zrndO2tPwv)](https://codecov.io/gh/pbulsink/PlotFTIR)
<!-- badges: end -->

([Français](#introduction-et-installation))

## Introduction and Installation
The goal of `PlotFTIR` is to easily and quickly kick-start the production of journal-quality Fourier Transform Infra-Red (FTIR) spectral plots in R using ggplot2. The produced plots can be published directly or further modified by ggplot2 functions.

You can install the development version of PlotFTIR from [GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("pbulsink/PlotFTIR")
```

## Example Plots

This is a basic example which shows you how to plot a prepared set of FTIR spectra:

```{r basic_plot_en}
library(PlotFTIR)
biodiesel_plot <- plot_ftir(biodiesel)
biodiesel_plot
```

We can also plot spectra in a stacked/offset manner instead of overlaid:
```{r stack_plot_en}
# Generate a plot
plot_ftir_stacked(biodiesel)
```

Plots can be manipulated, for example, by zooming in on a range:
```{r biodiesel_zoom_en}
# Zoom to a specified range of 1850 to 1650 cm^-1
zoom_in_on_range(biodiesel_plot, c(1650, 1850))
```

Some FTIR plots have a compressed low-energy portion of the graph. You can achieve this by the following:
```{r biodiesel_compress_en}
# compress the data with wavenumbers above 2000 (to the left of 2000 on the
# plot) by a factor of 5
compress_low_energy(biodiesel_plot, cutoff = 2000, compression_ratio = 5)
```

You can also add marker lines (with labels) at specific wavenumbers on the plots, controlling their line or text properties as needed.
```{r biodiesel_labelled_en}
biodiesel_marked <- add_wavenumber_marker(biodiesel_plot, 1742, "C=O Stretch", label_aesthetics = list("color" = "red"))
add_wavenumber_marker(biodiesel_marked, 2920, text = "C-H Stretch", line_aesthetics = list("linetype" = "dashed"))
```

If the need arises to rename samples listed in the legend, this is possible via `rename_plot_sample_ids()`. At this time, all samples must be listed in the rename vector with the format `"old name" = "new name"`. 
```{r biodiesel_rename_en}
new_names <- c(
  "biodiesel_0" = "0.0% Biodiesel",
  "biodiesel_0_25" = "0.25% Biodiesel",
  "biodiesel_0_50" = "0.50% Biodiesel",
  "biodiesel_1_0" = "1.0% Biodiesel",
  "biodiesel_2_5" = "2.5% Biodiesel",
  "biodiesel_5_0" = "5.0% Biodiesel",
  "biodiesel_7_5" = "7.5% Biodiesel",
  "biodiesel_10_0" = "10.0% Biodiesel",
  "biodiesel_B0_5" = "Commercial B0.5",
  "biodiesel_B5" = "Commercial B5",
  "diesel_unknown" = "Unknown Biodiesel"
)
rename_plot_sample_ids(biodiesel_plot, new_names)
```

A helper function for the renaming is provided (see the documentation for `get_plot_sample_ids()`).

## Data Sets

The package contains two datasets to provide example spectra for plotting:
* `biodiesel` is a set of diesels with 0 to 10 % FAMES (biodiesel) content, plus two known and one unknown diesel spectra.
* `sample_spectra` is a set of random FTIR spectra which includes spectra of pure toluene, isopropanol, and heptanes, as well as white printer paper and a polystyrene film.

An example of the `biodiesel` data set is below:
```{r biodiesel_head_en}
head(biodiesel)
```

## Tidy Plot Production

Note that because most functions return a data type similar to what is provided, tidy-eval is possible. 
```{r tidy_en, warning=FALSE}
new_ids <- c(
  "toluene" = "Toluene", "heptanes" = "C7 Alkane", "isopropanol" = "IPA",
  "paper" = "White Paper", "polystyrene" = "PS Film"
)

sample_spectra %>%
  absorbance_to_transmittance() %>%
  plot_ftir(plot_title = "Example FTIR Spectra") %>%
  zoom_in_on_range(c(3800, 800)) %>%
  compress_low_energy(compression_ratio = 4) %>%
  add_wavenumber_marker(1495, text = "C-C Aromatic", line_aesthetics = list("linetype" = "dashed"), label_aesthetics = list("color" = "#7e0021")) %>%
  add_wavenumber_marker(3340, text = "O-H Alcohol", line_aesthetics = list("linetype" = "dotted"), label_aesthetics = list("color" = "#ff420e")) %>%
  rename_plot_sample_ids(new_ids)
```

## Data Manipulation

FTIR spectral data can be converted between absorbance and transmittance. Only one type of data can exist in a data.frame and be plotted. The functions `absorbance_to_transmittance()` and `transmittance_to_absorbance()` perform these conversions.

```{r convert_datatype_en}
biodiesel_transm <- absorbance_to_transmittance(biodiesel)
head(biodiesel_transm)
```

## Documentation

More information on all functions is available online at [https://plotftir.pages.dev/](https://plotftir.pages.dev/).

## Code of Conduct

Please note that the PlotFTIR project is released with a [Contributor Code of Conduct](CODE_OF_CONDUCT.md). By contributing to this project, you agree to abide by its terms.


([English](#introduction-and-installation))

## Introduction et installation

L'objectif de `PlotFTIR` est de démarrer facilement et rapidement la production des tracés spectraux de spectroscopie infrarouge à transformée de Fourier (IRTF) de qualité journal dans R à l'aide de ggplot2. Les tracés produits peuvent être publiés directement ou modifiés davantage par les fonctions ggplot2.

Vous pouvez installer la version de développement de `PlotFTIR` depuis [GitHub](https://github.com/) avec :

``` r
# install.packages("devtools")
devtools::install_github("pbulsink/PlotFTIR")
```

## Exemples des tracés
Ceci est un example de base qui vous montre comment tracer un ensemble prépar de spectres IRTF:

```{r basic_plot_fr}
library(PlotFTIR)
plot_ftir(sample_spectra)
```

Nous pouvons également tracer les spectres de manière empilée/décalée au lieu de les superposer :
```{r stack_plot_fr}
plot_ftir_stacked(biodiesel)
```

Les tracés peuvent être manipulés, par exemple, en zoomant sur une plage :
```{r biodiesel_zoom_fr}
# Générer un tracé
biodiesel_trace <- plot_ftir(biodiesel)
# Zoom sur une plage spécifiée de 1850 à 1650 cm^-1
zoom_in_on_range(biodiesel_trace, c(1650, 1850))
```

Certains tracés FTIR ont une partie compressée du graphique à faible énergie. Vous pouvez y parvenir de la manière suivante :
```{r biodiesel_compress_fr}
# compresser les données avec des nombres d'onde supérieurs à 2000 (à gauche de
# 2000 sur le tracé) d'un facteur 5
compress_low_energy(biodiesel_plot, cutoff = 2000, compression_ratio = 5)
```

Vous pouvez également ajouter des lignes de marqueur (avec des étiquettes) à des numéros d'onde spécifiques sur les tracés, en contrôlant leurs propriétés de ligne ou de texte selon vos besoins.
```{r biodiesel_labelled_fr}
biodiesel_marked <- add_wavenumber_marker(biodiesel_plot, 1742, "C=O Stretch", label_aesthetics = list("color" = "red"))
add_wavenumber_marker(biodiesel_marked, 2920, text = "C-H Stretch", line_aesthetics = list("linetype" = "dashed"))
```

S'il est nécessaire de renommer les échantillons répertoriés dans la légende, cela est possible via `rename_plot_sample_ids()`. À ce stade, tous les échantillons doivent être répertoriés dans le vecteur de renommage au format `"ancien nom" = "nouveau nom"`.

```{r biodiesel_rename_fr}
new_names <- c(
  "biodiesel_0" = "0,0% Biodiesel",
  "biodiesel_0_25" = "0,25% Biodiesel",
  "biodiesel_0_50" = "0,50% Biodiesel",
  "biodiesel_1_0" = "1,0% Biodiesel",
  "biodiesel_2_5" = "2,5% Biodiesel",
  "biodiesel_5_0" = "5,0% Biodiesel",
  "biodiesel_7_5" = "7,5% Biodiesel",
  "biodiesel_10_0" = "10,0% Biodiesel",
  "biodiesel_B0_5" = "B0,5 Commercial",
  "biodiesel_B5" = "B5 Commercial",
  "diesel_unknown" = "Biodiesel Inconnu"
)
rename_plot_sample_ids(biodiesel_plot, new_names)
```

Une fonction d'assistance pour le changement de nom est fournie (voir la documentation pour `get_plot_sample_ids()`).

```{r tidy_fr, warning=FALSE}
nouveaux_ids <- c(
  "toluene" = "Toluène", "heptanes" = "C7 alcane", "isopropanol" = "alcool isopropylique",
  "paper" = "papier blanc", "polystyrene" = "film de polystyrène"
)

sample_spectra %>%
  absorbance_to_transmittance() %>%
  plot_ftir(plot_title = "Exemple de spectres IRTF") %>%
  zoom_in_on_range(c(3800, 800)) %>%
  compress_low_energy(compression_ratio = 4) %>%
  add_wavenumber_marker(1495, text = "C-C aromatique", line_aesthetics = list("linetype" = "dashed"), label_aesthetics = list("color" = "#7e0021")) %>%
  add_wavenumber_marker(3340, text = "O-H alcool", line_aesthetics = list("linetype" = "dotted"), label_aesthetics = list("color" = "#ff420e")) %>%
  rename_plot_sample_ids(nouveaux_ids)
```

## Production de tracés "tidy" 

Notez que, comme la plupart des fonctions renvoient un type de données similaire à celui fourni, une "tidy-eval" est possible.



## Ensembles des données

Le package contient deux ensembles de données pour fournir des exemples de spectres à tracer :
* `biodiesel` est un ensemble de diesels avec une teneur en FAMES (biodiesel) de 0 à 10 %, plus deux spectres de diesel connus et un inconnu.
* `sample_spectra` est un ensemble de spectres IRTF aléatoires qui comprennent des spectres de toluène pur, d'isopropanol et d'heptanes, ainsi que du papier d'imprimante blanc et un film de polystyrène.

Un exemple de l'ensemble de données `biodiesel` est ci-dessous:
```{r biodiesel_head_fr}
head(biodiesel)
```

## Manipulation de données

Les données spectrales FTIR peuvent être converties entre l'absorbance et la transmission. Un seul type de données peut exister dans un data.frame et être tracé. Les fonctions `absorbance_to_transmittance()` et `transmittance_to_absorbance()` effectuent ces conversions.

```{r convert_datatype_fr}
biodiesel_transm <- absorbance_to_transmittance(biodiesel)
head(biodiesel_transm)
```

## Documentation

Plus d'informations sur toutes les fonctions sont disponibles en ligne sur [https://plotftir.pages.dev/](https://plotftir.pages.dev/).

## Code de conduite

Veuillez noter que le projet PlotFTIR est publié avec un [Code de conduite pour le projet](CODE_OF_CONDUCT.md). En contribuant à ce projet, vous acceptez d'en respecter les termes.
